<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modu Bank</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div id="main-img-wrapper">
      <img
        width="320px"
        src="./imgs/Lovepik_com-401339128-data-management-data-analysis-icon-free-vector-illustration-mate.png"
        alt="coding image"
      />
    </div>
    <div id="intro-main">
      <p>이미 모두의 은행, modu bank</p>
      <p>함께 일해요.</p>
      <p id="join-us-text">Join us!</p>
      <img id="down-arrow-icon" src="./imgs/down-arrow.png" alt="down arrow" />
    </div>
    <ul id="list-item-wrapper">
      <li class="list-item">가나다라</li>
      <li class="list-item">마바사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의 주제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마바사</li>
      <li class="list-item">아자차타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의 주제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마바사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의주제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의 주제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마바사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘 주제는</li>
      <li class="list-item">움직이 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의 제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
      <li class="list-item">가나다라</li>
      <li class="list-item">마바사</li>
      <li class="list-item">아자차카타</li>
      <li class="list-item">파하</li>
      <li class="list-item">오늘의 주제는</li>
      <li class="list-item">움직이는 글씨입니다</li>
    </ul>
    <main>
      <section id="panel1-img">
        <img
          id="flying-santa-image"
          src="./imgs/santa_flying.png"
          alt="santa flying"
        />
      </section>
      <section id="video-section">
        <div id="fixed-wrapper">
          <video
            id="video"
            src="./imgs/치즈 100장으로 라면사리 끓여질까_.mp4"
            type="video/mp4"
            muted
            loop
          ></video>
          <div id="fixed-description">
            <div>혁신이 만든</div>
            <div>압도적인 성장</div>
          </div>
        </div>
      </section>
      <div id="bank-beyond-wrapper">
        <div id="bank-beyond">
          <img width="315" src="./imgs/05-text.png" alt="sample text" />
        </div>
      </div>
      <div id="white-wrapper">
        <div id="slider-container">
          <div id="slider-content-wrapper">
            <div id="slider-content">
              <img
                src="https://picsum.photos/id/199/600/933"
                class="slider-image"
                alt=""
              />
              <img
                src="https://picsum.photos/id/132/600/933"
                class="slider-image"
                alt=""
              />
              <img
                src="https://picsum.photos/id/122/600/933"
                class="slider-image"
                alt=""
              />
            </div>
          </div>
          <div class="slider-button" id="left-button">&lt;</div>
          <div class="slider-button" id="right-button">&gt;</div>
        </div>
      </div>
    </main>
  </body>
  <script>
    const listStyleChangeStartY = 564;
    const listStyleChangeEndY = 2388;
    const listItems = document.querySelectorAll(".list-item");

    //li 하나당 분배할 수 있는 스크롤px
    const division =
      (listStyleChangeEndY - listStyleChangeStartY) / listItems.length;

    //시작부터 현재 스크롤한 값은 window.scrollY - listStyleStartY
    //현재 스타일이 켜져야 할 li값은 division으로 나눈 값

    const panelImg = document.getElementById("panel1-img");

    const flyingSanta = document.getElementById("flying-santa-image");

    //플레이백 : 숫자가 낮을 수록 빠름
    const videoPlayBack = 500;

    const videoElement = document.getElementById("video");
    const videoSection = document.getElementById("video-section");

    const fixedWrapper = document.getElementById("fixed-wrapper");
    const fixedDescription = document.getElementById("fixed-description");

    //video에 이벤트리스너를 걸면 어떤 비디오의 길이나 코덱을 갖고 있는지 알 수 있음
    //video-section의 높이가 비디오 재생시간 * 플레이백을 곱한 높이 (스크롤높이 조절 )
    videoElement.addEventListener("loadedmetadata", () => {
      console.log(videoElement.duration);
      document.getElementById("video-section").style.height =
        videoElement.duration * videoPlayBack + "px";
      console.log(document.getElementById("video-section").style.height);
    });

    const fixedDescriptionAppearTiming = 26945;
    const fixedDescriptionAppearEnds = 26962;

    function centerElement(elementId, video) {
      const element = document.getElementById(elementId);
      const parent = element.parentElement;
      //엘리먼트의 부모요소
      //동영상 길이만큼 height를 조정해놓은 것

      //동영상이 센터에 도달했을 때 포지션을 fix하는 것
      if (
        window.scrollY >
        parent.offsetTop -
          (document.documentElement.clientHeight - element.offsetHeight) / 2
      ) {
        element.style.position = "fixed";
        element.style.top = "50%";
        element.style.left = "50%";
        element.style.transform = "translate(-50%, -50%)";

        //현재 보여줄 화면 (스크롤에 따라 내려가면서 커짐 videoPlayBack로 나누어보여줌) 점점 숫자가 커짐
        if (video) {
          video.currentTime =
            (window.scrollY - videoSection.offsetTop) / videoPlayBack;
          // console.log(window.scrollY);
          // console.log(videoSection.offsetTop);
        }
      } else {
        element.style.position = "relative";
        element.style.top = "initial";
        element.style.left = "initial";
        element.style.transform = "initial";
      }
    }
    //화면스크롤에따라 재생시키는 액션을 하기 위해
    //스크롤을 내려도 화면이 내려가지 않게 함

    window.addEventListener("scroll", (event) => {
      console.log(window.scrollY);
      // console.log(window.pageYOffset);
      if (document.getElementById("on")) {
        document.getElementById("on").removeAttribute("id");
      }

      if (
        window.scrollY >= listStyleChangeStartY &&
        window.scrollY < listStyleChangeEndY
      ) {
        let targetIndex = Math.floor(
          (window.scrollY - listStyleChangeStartY) / division
        );
        listItems[targetIndex].id = "on";
      }

      const scrollYBottom =
        window.scrollY + document.documentElement.clientHeight;
      //맨위 스크롤 위치 scrollY+ 화면높이(clientHeight)ㅏ\ㅏ ,ㅗㅎ

      // console.log(panelImg.offsetTop + panelImg.offsetHeight);
      if (
        scrollYBottom > panelImg.offsetTop &&
        scrollYBottom < panelImg.offsetTop + panelImg.offsetHeight + 100
      ) {
        const translateX =
          80 -
          (80 * 1.43 * (scrollYBottom - panelImg.offsetTop)) /
            panelImg.offsetHeight +
          100;
        const translateY =
          -13 +
          (13 * (scrollYBottom - panelImg.offsetTop)) / panelImg.offsetHeight +
          100;

        const rotationDegree =
          23 -
          (23 * 1.7 * (scrollYBottom - panelImg.offsetTop)) /
            panelImg.offsetHeight;
        flyingSanta.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${rotationDegree}deg)`;
      }

      centerElement("fixed-wrapper", videoElement);

      //비디오 스크롤이 모두 끝났을 때의 스크롤값은

      //document에서 비디오섹션높이에서 + 비디오 자체 높이를 더하고 (비디오끝난 스크롤 위치)
      //픽스되어있는 높이의 document높이에서 반절되는 높이를 더한 값을 뻄
      //그 값을 넘었을 때 (아래쪽 중앙이 넘었을 때)
      //videoSection.offsetTop : 4224
      // videoSection.offsetHeight: 23777
      //fixedWrapper.offsetHeight : 930
      if (
        window.scrollY >
        videoSection.offsetTop +
          videoSection.offsetHeight -
          (fixedWrapper.offsetHeight +
            (document.documentElement.clientHeight -
              fixedWrapper.offsetHeight) /
              2)
      ) {
        fixedWrapper.style.position = "relative";
        fixedWrapper.style.top = "initial";
        fixedWrapper.style.left = "initial";
        fixedWrapper.style.transform = `translateY(${
          videoSection.offsetHeight - fixedWrapper.offsetHeight
        }px)`;
        //픽스되었다가 원래 위치로 옮기는데
        //fixedWrapper의 요소높이를 뺸 값만큼의 높이로 아래로 옮김
        //23777-930
        console.log(videoSection.offsetTop);
        console.log(videoSection.offsetHeight);
        console.log(fixedWrapper.offsetHeight);
      }
      if (
        window.scrollY > fixedDescriptionAppearTiming &&
        window.scrollY < fixedDescriptionAppearEnds
      ) {
        //description이 나타나는 타이밍 스크롤 내에 있을 때
        //translateY의 위치가 점점 위로 올라옴
        fixedDescription.style.transform = `translateY(${
          fixedDescriptionAppearEnds - window.scrollY
        }px)`;
        console.log(window.scrollY - fixedDescriptionAppearTiming);
        //appeartiming에 scrollY가 있을 때부터 시작해서 opacity값은 점점 커지므로
        //점점 짙어짐
        fixedDescription.style.opacity =
          (window.scrollY - fixedDescriptionAppearTiming) / 20;
      } else if (window.scrollY > fixedDescriptionAppearEnds) {
        //apeear스크롤 밖에 있을 때
        fixedDescription.style.transform = `translateY(0px)`;
        fixedDescription.style.opacity = 1;
      } else {
        //그 전일때
        fixedDescription.style.transform = `translateY(100px)`;
        fixedDescription.style.opacity = 0;
      }

      centerElement("bank-beyond");
    });
  </script>
</html>
